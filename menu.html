<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --main-gradient: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --main-color: #f7971e;
            --main-dark: #ff8800;
            --card-radius: 22px;
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.13);
        }
        body {
            font-family: 'Tajawal', 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--main-gradient);
            min-height: 100vh;
        }
        .navbar {
            background: var(--main-gradient);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            padding: 1rem 0;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0;
        }
        .navbar-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
            position: relative;
            padding: 0.5rem;
        }
        .navbar-brand {
            color: #fff !important;
            font-weight: bold;
            font-size: 2rem;
            letter-spacing: 2px;
            text-shadow: 1px 1px 8px rgba(0,0,0,0.08);
        }
        .main-title {
            color: #222;
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            letter-spacing: 1px;
            animation: fadeInDown 1.2s cubic-bezier(.39,.575,.56,1) both;
        }
        .main-title::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: var(--main-color);
            border-radius: 3px;
            animation: slideInLeft 1.2s cubic-bezier(.39,.575,.56,1) both;
        }
        .search-section {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: var(--card-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        .search-input {
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 0.8rem 1.2rem;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        .search-input:focus {
            border-color: var(--main-color);
            box-shadow: 0 0 0 0.2rem rgba(247, 151, 30, 0.25);
        }
        
        .category-btn {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 0.6rem 1.2rem;
            font-size: 1rem;
            color: #666;
            transition: all 0.3s ease;
            margin: 0.3rem;
        }
        .category-btn:hover, .category-btn.active {
            background: var(--main-gradient);
            border-color: var(--main-color);
            color: white;
        }
        .menu-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .menu-card {
            background: #fff;
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            animation: zoomIn 1s cubic-bezier(.39,.575,.56,1) both;
            position: relative;
            z-index: 1;
        }
        .menu-card:hover {
            transform: translateY(-12px) scale(1.05);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
            z-index: 2;
        }
        .menu-img-container {
            width: 100%;
            height: 200px;
            overflow: hidden;
            position: relative;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .menu-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .menu-card:hover .menu-img {
            transform: scale(1.05);
        }
        .menu-details {
            padding: 1.2rem 1.5rem 1.5rem 1.5rem;
            width: 100%;
            text-align: center;
        }
        .menu-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--main-dark);
            margin-bottom: 0.7rem;
            letter-spacing: 1px;
        }
        .menu-price {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 1.1rem;
        }
        .menu-category {
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            display: inline-block;
            margin-bottom: 1rem;
        }
        .menu-sales {
            font-size: 0.9rem;
            color: #28a745;
            margin-bottom: 1rem;
        }
        .qty-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.2rem;
            margin-top: 0.7rem;
        }
        .qty-btn {
            background: var(--main-gradient);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 38px;
            height: 38px;
            font-size: 1.5rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(67,206,162,0.10);
            transition: all 0.2s;
            cursor: pointer;
        }
        .qty-btn:active {
            transform: scale(0.93);
        }
        .qty-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #222;
            min-width: 32px;
            text-align: center;
        }
        .best-sellers {
            background: rgba(255, 255, 255, 0.9);
            padding: 1.5rem;
            border-radius: var(--card-radius);
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
        }
        .best-sellers-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--main-dark);
            margin-bottom: 1rem;
            text-align: center;
        }
        .best-sellers-list {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
        }
        .best-seller-item {
            min-width: 200px;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
        }
        .best-seller-name {
            font-weight: bold;
            color: var(--main-dark);
            margin-bottom: 0.5rem;
        }
        .best-seller-sales {
            color: #28a745;
            font-size: 0.9rem;
        }
        .order-btn {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
            white-space: nowrap;
            display: inline-block !important;
            cursor: pointer;
        }
        .order-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            animation: none;
        }
        .order-btn:active {
            transform: translateY(0);
        }
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }
        .invoice-modal .modal-content {
            border-radius: 20px;
            border: none;
        }
        .invoice-modal .modal-header {
            background: var(--main-gradient);
            color: white;
            border-radius: 20px 20px 0 0;
        }
        .invoice-modal .modal-body {
            padding: 2rem;
        }
        .invoice-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 0;
            border-bottom: 1px solid #eee;
        }
        .invoice-item h6 {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--main-dark);
        }
        .invoice-item small {
            font-size: 1rem;
            color: #666;
        }
        .invoice-total {
            font-size: 1.4rem !important;
            font-weight: bold;
            color: var(--main-dark);
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 2px solid #eee;
        }
        .complete-order-btn {
            background: var(--main-gradient);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-weight: bold;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        .complete-order-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(247, 151, 30, 0.3);
        }
        .cart-btn {
            position: relative;
            padding-right: 2.5rem;
            margin-right: 1rem;
            overflow: visible !important;
            z-index: 1;
        }
        .cart-count {
            position: absolute;
            top: -12px;
            right: -12px;
            left: auto;
            transform: none;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            min-width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            animation: bounce 1s infinite;
            padding: 0 8px;
            z-index: 100;
            box-shadow: 0 3px 8px rgba(220, 53, 69, 0.3);
            border: 2px solid white;
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }
        .cart-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2);
        }
        .cart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
        }
        .cart-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 123, 255, 0.2);
        }
        .cart-modal .modal-content {
            border-radius: 20px;
            border: none;
        }
        .cart-modal .modal-header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }
        .cart-item {
            background: white;
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .cart-item-img {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            object-fit: cover;
        }
        .cart-item-details {
            flex: 1;
        }
        .cart-item-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--main-dark);
            margin-bottom: 0.5rem;
        }
        .cart-item-price {
            font-size: 1.1rem;
            color: #666;
        }
        .cart-item-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--main-dark);
        }
        .cart-item-remove {
            color: #dc3545;
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .cart-item-remove:hover {
            transform: scale(1.2);
        }
        .cart-empty {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        .cart-empty i {
            font-size: 3rem;
            color: #ddd;
            margin-bottom: 1rem;
        }
        .modal-header .btn-close {
            margin: -0.5rem auto -0.5rem -0.5rem;
        }
        .modal-header {
            position: relative;
        }
        .modal-title {
            margin-right: auto;
            margin-left: 0;
        }
        .logout-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-weight: bold;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            animation: fadeInDown 0.8s ease;
            position: relative;
            overflow: hidden;
        }
        .logout-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
        }
        .logout-btn:active {
            transform: translateY(-1px) scale(0.98);
        }
        .logout-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                120deg,
                transparent,
                rgba(255, 255, 255, 0.2),
                transparent
            );
            transition: 0.5s;
        }
        .logout-btn:hover::before {
            left: 100%;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .invoice-item {
            animation: fadeInUp 0.5s ease;
        }
        @keyframes fadeInUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ÿπŸÑŸâ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ */
        
        /* ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ŸÜŸÇŸÑ ŸÑŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
        @media (max-width: 992px) {
            .navbar .container {
                flex-direction: column;
                padding: 0.5rem;
            }
            
            .navbar-brand {
                font-size: 1.5rem;
                margin-bottom: 0.5rem;
            }
            
            .navbar-buttons {
                width: 100%;
                justify-content: space-between;
                gap: 0.5rem;
            }
            
            .cart-btn, .order-btn, .logout-btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            
            .cart-count {
                min-width: 26px;
                height: 26px;
                font-size: 0.8rem;
                top: -8px;
                right: -8px;
            }
            
            .container {
                margin-top: 12px !important; 
            }
            
            .menu-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }
            
            .menu-img-container {
                height: 180px;
            }
            
            .menu-name {
                font-size: 1.2rem;
            }
            
            .menu-price {
                font-size: 1rem;
            }
            
            .qty-btn {
                width: 34px;
                height: 34px;
                font-size: 1.3rem;
            }
            
            .qty-value {
                font-size: 1.1rem;
            }
        }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑŸáŸàÿßÿ™ŸÅ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© ÿ¨ÿØÿßŸã */
        @media (max-width: 576px) {
            .navbar-buttons {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .cart-btn, .order-btn {
                width: 100%;
                justify-content: center;
            }
            
            .main-title {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
            }
            
            .main-title::after {
                width: 80px;
                bottom: -8px;
            }
            
            .search-input {
                font-size: 1rem;
                padding: 0.6rem 1rem;
            }
            
            .category-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
                margin: 0.2rem;
            }
            
            .search-section {
                padding: 1rem;
            }
            
            .menu-container {
                grid-template-columns: 1fr;
                gap: 1.2rem;
            }
            
            .menu-card {
                flex-direction: row;
                align-items: stretch;
            }
            
            .menu-img-container {
                width: 120px;
                height: auto;
                flex-shrink: 0;
            }
            
            .menu-details {
                padding: 1rem;
                text-align: right;
            }
            
            .menu-name {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }
            
            .menu-price {
                font-size: 0.95rem;
                margin-bottom: 0.8rem;
            }
            
            .menu-category {
                font-size: 0.8rem;
                margin-bottom: 0.8rem;
            }
            
            .qty-controls {
                gap: 0.8rem;
                margin-top: 0.5rem;
            }
            
            .qty-btn {
                width: 30px;
                height: 30px;
                font-size: 1.1rem;
            }
            
            .qty-value {
                font-size: 1rem;
            }
            
            .cart-item {
                flex-direction: column;
                text-align: center;
            }
            
            .cart-item-img {
                width: 100%;
                height: 120px;
            }
            
            .cart-item-details {
                width: 100%;
            }
            
            .cart-item-name {
                font-size: 1.1rem;
            }
            
            .cart-item-price {
                font-size: 1rem;
            }
            
            .cart-item-total {
                font-size: 1.1rem;
            }
            
            .invoice-modal .modal-body,
            .cart-modal .modal-body {
                padding: 1rem;
            }
            
            .invoice-item h6 {
                font-size: 1rem;
            }
            
            .invoice-item small {
                font-size: 0.9rem;
            }
            
            .invoice-total {
                font-size: 1.2rem !important;
            }
        }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ÿßŸÑÿ≠ÿ¨ŸÖ */
        @media (min-width: 577px) and (max-width: 768px) {
            .menu-container {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .menu-img-container {
                height: 160px;
            }
        }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ŸÑŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑŸÉÿ®Ÿäÿ±ÿ© ÿ¨ÿØÿßŸã */
        @media (min-width: 1600px) {
            .container {
                max-width: 1500px;
            }
            
            .menu-container {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
            
            .menu-img-container {
                height: 250px;
            }
        }
        
        /* ÿ•ÿµŸÑÿßÿ≠ ŸÖÿ¥ŸÉŸÑÿ© ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ */
        .search-section .row {
            display: flex;
            flex-wrap: wrap;
        }
        
        .search-section .col-md-6 {
            flex: 0 0 50%;
            max-width: 50%;
        }
        
        @media (max-width: 768px) {
            .search-section .col-md-6 {
                flex: 0 0 100%;
                max-width: 100%;
            }
            
            #searchInput {
                margin-bottom: 1rem;
            }
        }
        
        /* ÿ™ÿ≠ÿ≥ŸäŸÜ ÿ∏ŸáŸàÿ± ŸÖÿ±ÿ®ÿπ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿßŸÑÿ£ÿ¨Ÿáÿ≤ÿ© ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
        #searchInput {
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark mb-4">
    <div class="container">
        <a class="navbar-brand animate__animated animate__fadeIn" href="/">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ</a>
        <div class="navbar-buttons">
            <button id="cartBtn" class="cart-btn" onclick="showCart()">
                <i class="fas fa-shopping-cart me-2"></i>
                ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
                <span id="cartCount" class="cart-count" style="display: none;">0</span>
            </button>
            <button id="orderBtn" class="order-btn" onclick="showInvoice()">
                <i class="fas fa-check-circle me-2"></i>
                ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
            </button>
            <button id="logoutBtn" class="logout-btn d-none" onclick="logout()">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨</button>
        </div>
    </div>
</nav>

<div class="container">
    <h2 class="main-title">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ</h2>
    
    <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ŸàÿßŸÑÿ™ÿµŸÜŸäŸÅ -->
    <div class="search-section">
        <div class="row g-3">
            <div class="col-md-6">
                <input type="text" class="form-control search-input" id="searchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∑ÿπÿßŸÖ...">
            </div>
            <div class="col-md-6">
                <div class="d-flex flex-wrap justify-content-center" id="categoryButtons">
                    <button class="category-btn active" data-category="all">ÿßŸÑŸÉŸÑ</button>
                    <!-- ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßŸã -->
                </div>
            </div>
        </div>
    </div>

    <div id="menuContainer" class="menu-container">
        <!-- ÿßŸÑÿ£ÿµŸÜÿßŸÅ ÿ≥ÿ™ÿ∏Ÿáÿ± ŸáŸÜÿß -->
    </div>
</div>

<!-- ŸÇÿ≥ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
<div id="loginSection" class="modal fade" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ</h5>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="email" class="form-label">ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="mb-3">
                        <label for="password" class="form-label">ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±</label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="password" required>
                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>
                    <div id="loginError" class="alert alert-danger" style="display:none;"></div>
                    <button type="submit" class="btn btn-primary w-100">ÿØÿÆŸàŸÑ</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© -->
<div class="modal fade invoice-modal" id="invoiceModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                <h5 class="modal-title">ŸÅÿßÿ™Ÿàÿ±ÿ© ÿßŸÑÿ∑ŸÑÿ®</h5>
            </div>
            <div class="modal-body">
                <div id="invoiceItems">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿßÿµÿ± ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ© ŸáŸÜÿß -->
                </div>
                <div class="invoice-total text-end">
                    ÿßŸÑŸÖÿ¨ŸÖŸàÿπ: <span id="invoiceTotal">0</span> <span id="invoiceCurrency"></span>
                </div>
                <button class="complete-order-btn" onclick="completeOrder()">
                    <i class="fas fa-check-circle me-2"></i>
                    ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑÿ≥ŸÑÿ© -->
<div class="modal fade cart-modal" id="cartModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                <h5 class="modal-title">ÿ≥ŸÑÿ© ÿßŸÑÿ∑ŸÑÿ®ÿßÿ™</h5>
            </div>
            <div class="modal-body">
                <div id="cartItems">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿπŸÜÿßÿµÿ± ÿßŸÑÿ≥ŸÑÿ© ŸáŸÜÿß -->
                </div>
                <div id="cartEmpty" class="cart-empty" style="display: none;">
                    <i class="fas fa-shopping-cart"></i>
                    <p>ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyCG3hq-knPzBLycrC1Nxpo0dWo9FaffzX4",
    authDomain: "chefdesk-9d2b7.firebaseapp.com",
    databaseURL: "https://chefdesk-9d2b7-default-rtdb.firebaseio.com",
    projectId: "chefdesk-9d2b7",
    storageBucket: "chefdesk-9d2b7.firebasestorage.app",
    messagingSenderId: "284469606378",
    appId: "1:284469606378:web:ff5d1c70e23346435f6493"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const auth = firebase.auth();

let currentUser = null;
let menuItems = {};
let categories = new Set();
let userSettings = {
    currency: '$',
    currencySymbol: '$'
};

// ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ™ÿ∫Ÿäÿ± ÿπÿßŸÖ ŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÉŸÖŸäÿßÿ™
let itemQuantities = {};

// ÿØÿßŸÑÿ© ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
function showLoginSection() {
    const loginModal = new bootstrap.Modal(document.getElementById('loginSection'));
    loginModal.show();
    // ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
    document.getElementById('logoutBtn').classList.add('d-none');
    // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
    document.getElementById('loginForm').reset();
    document.getElementById('loginError').style.display = 'none';
}

// ÿØÿßŸÑÿ© ÿ•ÿÆŸÅÿßÿ° ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
function hideLoginSection() {
    const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginSection'));
    if (loginModal) {
        loginModal.hide();
    }
    // ÿ•ÿ∏Ÿáÿßÿ± ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
    document.getElementById('logoutBtn').classList.remove('d-none');
}

// ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
function logout() {
    if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ÿ£ŸÜŸÉ ÿ™ÿ±ŸäÿØ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü')) {
        const logoutBtn = document.getElementById('logoutBtn');
        logoutBtn.disabled = true;
        logoutBtn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨...';
        
        auth.signOut().then(() => {
            showLoginSection();
            logoutBtn.disabled = false;
            logoutBtn.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨';
        }).catch((error) => {
            console.error("Error signing out:", error);
            alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
            logoutBtn.disabled = false;
            logoutBtn.textContent = 'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨';
        });
    }
}

// ŸÖÿ±ÿßŸÇÿ®ÿ© ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿµÿßÿØŸÇÿ©
auth.onAuthStateChanged(function(user) {
    if (user) {
        currentUser = user;
        hideLoginSection();
        fetchUserSettings(user.uid);
        fetchMenuItems(user.uid);
    } else {
        currentUser = null;
        showLoginSection();
    }
});

// ŸÜŸÖŸàÿ∞ÿ¨ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
const loginForm = document.getElementById('loginForm');
if (loginForm) {
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        const submitBtn = loginForm.querySelector('button[type="submit"]');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ...';
        submitBtn.disabled = true;
        
        // ÿ•ÿÆŸÅÿßÿ° ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£ ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
        const loginError = document.getElementById('loginError');
        loginError.style.display = 'none';
        
        auth.signInWithEmailAndPassword(email, password)
            .then((userCredential) => {
                currentUser = userCredential.user;
                hideLoginSection();
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            })
            .catch((error) => {
                let errorMessage = '';
                switch (error.code) {
                    case 'auth/invalid-email':
                        errorMessage = 'ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ Ÿáÿ∞ÿß ÿßŸÑÿ≠ÿ≥ÿßÿ®';
                        break;
                    case 'auth/user-not-found':
                        errorMessage = 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿ≠ÿ≥ÿßÿ® ÿ®Ÿáÿ∞ÿß ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿ∫Ÿäÿ± ÿµÿ≠Ÿäÿ≠ÿ©';
                        break;
                    case 'auth/network-request-failed':
                        errorMessage = 'ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ¥ÿ®ŸÉÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑŸÉ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™';
                        break;
                    case 'auth/too-many-requests':
                        errorMessage = 'ÿ™ŸÖ ÿ™ÿπÿ∑ŸäŸÑ ÿßŸÑŸàÿµŸàŸÑ ŸÖÿ§ŸÇÿ™ÿßŸã ÿ®ÿ≥ÿ®ÿ® ŸÖÿ≠ÿßŸàŸÑÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿØÿÆŸàŸÑ ŸÖÿ™ŸÉÿ±ÿ±ÿ©. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÑÿßÿ≠ŸÇÿßŸã';
                        break;
                    default:
                        errorMessage = 'ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ';
                }
                
                loginError.textContent = errorMessage;
                loginError.style.display = 'block';
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                
                // ÿ•ÿπÿßÿØÿ© ÿ™ŸÅÿπŸäŸÑ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿ®ÿπÿØ 3 ÿ´ŸàÿßŸÜŸä
                setTimeout(() => {
                    submitBtn.disabled = false;
                }, 3000);
            });
    });
}

// ÿØÿßŸÑÿ© ÿ¨ŸÑÿ® ÿßŸÑÿ£ÿµŸÜÿßŸÅ
function fetchMenuItems(uid) {
    const userMenuRef = database.ref(`users/${uid}/menu_items`);
    userMenuRef.on('value', (snapshot) => {
        const items = snapshot.val() || {};
        processMenuItems(items);
    }, (error) => {
        console.error("Error fetching menu items:", error);
        showError("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∑ÿπÿßŸÖ");
    });
}

// ÿØÿßŸÑÿ© ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑÿ£ÿµŸÜÿßŸÅ
function processMenuItems(items) {
    menuItems = items;
    categories.clear();
    
    // ÿ¨ŸÖÿπ ÿßŸÑÿ™ÿµŸÜŸäŸÅÿßÿ™
    Object.values(menuItems).forEach(item => {
        if (item && item.category) {
            categories.add(item.category);
        }
    });
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ
    updateCategoryButtons();
    
    // ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿµŸÜÿßŸÅ
    displayMenuItems(menuItems);
}

// ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ™ÿµŸÜŸäŸÅ
function updateCategoryButtons() {
    const categoryButtons = document.getElementById('categoryButtons');
    categoryButtons.innerHTML = '<button class="category-btn active" data-category="all" onclick="filterItems(\'all\')">ÿßŸÑŸÉŸÑ</button>';
    
    categories.forEach(category => {
        const button = document.createElement('button');
        button.className = 'category-btn';
        button.dataset.category = category;
        button.textContent = category;
        button.onclick = () => filterItems(category);
        categoryButtons.appendChild(button);
    });
}

// ÿØÿßŸÑÿ© ÿ™ÿµŸÅŸäÿ© ÿßŸÑÿ£ÿµŸÜÿßŸÅ
function filterItems(category) {
    const buttons = document.querySelectorAll('.category-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    
    const activeBtn = document.querySelector(`.category-btn[data-category="${category}"]`);
    if (activeBtn) {
        activeBtn.classList.add('active');
    }
    
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const filteredItems = {};
    
    Object.entries(menuItems).forEach(([id, item]) => {
        if (!item) return;
        
        const matchesCategory = category === 'all' || item.category === category;
        const matchesSearch = item.name.toLowerCase().includes(searchTerm);
        
        if (matchesCategory && matchesSearch) {
            filteredItems[id] = item;
        }
    });
    
    displayMenuItems(filteredItems);
}

// ÿØÿßŸÑÿ© ÿßŸÑÿ®ÿ≠ÿ´
document.getElementById('searchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const activeCategoryBtn = document.querySelector('.category-btn.active');
    const activeCategory = activeCategoryBtn ? activeCategoryBtn.dataset.category : 'all';
    filterItems(activeCategory);
});

// ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿÆÿ∑ÿ£
function showError(message) {
    const menuContainer = document.getElementById('menuContainer');
    menuContainer.innerHTML = `
        <div class="alert alert-danger text-center" role="alert">
            ${message}
        </div>
    `;
}

// ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿµŸÜÿßŸÅ
function displayMenuItems(items) {
    const menuContainer = document.getElementById('menuContainer');
    menuContainer.innerHTML = '';
    
    if (Object.keys(items).length === 0) {
        menuContainer.innerHTML = `
            <div class="alert alert-info text-center" role="alert">
                ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿµŸÜÿßŸÅ ŸÖÿ™ÿßÿ≠ÿ© ÿ≠ÿßŸÑŸäÿßŸã
            </div>
        `;
        return;
    }
    
    Object.entries(items).forEach(([id, item]) => {
        if (!item) return;
        
        const menuItem = document.createElement('div');
        menuItem.className = 'menu-card animate__animated animate__fadeInUp';
        menuItem.style.animationDelay = `${parseInt(id) * 0.1}s`;
        
        // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÉŸÖŸäÿ© ÿßŸÑŸÖÿÆÿ≤ŸÜÿ© ŸÅŸä ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿπÿßŸÖ ÿ≠ÿ™Ÿâ ŸÑŸà ŸÑŸÖ ÿ™ŸÉŸÜ ŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ≠ÿßŸÑŸäÿßŸã
        const currentQty = itemQuantities[id] || 0;
        
        let imageHtml = '';
        if (item.image_path) {
            let imageUrl = item.image_path;
            const match = imageUrl.match(/id=([\w-]+)/);
            if (match && match[1]) {
                imageUrl = `https://drive.google.com/thumbnail?id=${match[1]}`;
            }
            imageHtml = `
                <div class="menu-img-container">
                    <img src="${imageUrl}"
                         class="menu-img"
                         alt="${item.name}"
                         loading="lazy"
                         onerror="this.onerror=null; this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNmOGY5ZmEiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iNDAiIGZpbGw9IiNiYmIiPjLwn5GPPC90ZXh0Pjwvc3ZnPg=='">
                </div>`;
        } else {
            imageHtml = `
                <div class="menu-img-container">
                    <div class="menu-img d-flex align-items-center justify-content-center"
                         style="color:#bbb;font-size:2.5rem;background:#f8f9fa;">üçΩÔ∏è</div>
                </div>`;
        }

        menuItem.innerHTML = `
            ${imageHtml}
            <div class="menu-details">
                <h3 class="menu-name">${item.name}</h3>
                <span class="menu-category">${item.category || 'ÿ®ÿØŸàŸÜ ÿ™ÿµŸÜŸäŸÅ'}</span>
                <p class="menu-price">${item.price.toFixed(2)} ${userSettings.currency}</p>
                <div class="qty-controls">
                    <button class="qty-btn" onclick="updateQuantity('${id}', -1)">-</button>
                    <span class="qty-value" id="qty-${id}">${currentQty}</span>
                    <button class="qty-btn" onclick="updateQuantity('${id}', 1)">+</button>
                </div>
            </div>
        `;
        menuContainer.appendChild(menuItem);
    });
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿ≤ÿ± ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸàÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ©
    updateOrderButton();
    updateCartCount();
}

// ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉŸÖŸäÿ©
function updateQuantity(itemId, change, fromCart = false) {
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉŸÖŸäÿ© ŸÅŸä ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿπÿßŸÖ
    itemQuantities[itemId] = (itemQuantities[itemId] || 0) + change;
    itemQuantities[itemId] = Math.max(0, itemQuantities[itemId]);
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπŸÜÿµÿ± ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖÿ±ÿ¶ŸäŸãÿß
    const qtyElement = document.getElementById(`qty-${itemId}`);
    if (qtyElement) {
        qtyElement.textContent = itemQuantities[itemId];
    }
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉŸÖŸäÿ© ŸÅŸä ÿßŸÑÿ≥ŸÑÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
    const cartQtyElement = document.getElementById(`cart-qty-${itemId}`);
    if (cartQtyElement) {
        cartQtyElement.textContent = itemQuantities[itemId];
        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖÿ¨ŸÖŸàÿπ ŸÅŸä ÿßŸÑÿ≥ŸÑÿ©
        const item = menuItems[itemId];
        if (item) {
            const itemTotal = itemQuantities[itemId] * item.price;
            const cartItem = document.getElementById(`cart-item-${itemId}`);
            if (cartItem) {
                const totalElement = cartItem.querySelector('.cart-item-total');
                if (totalElement) {
                    totalElement.textContent = `${itemTotal.toFixed(2)} ${userSettings.currency}`;
                }
            }
        }
    }
    
    // ÿ•ÿ∞ÿß ÿ™ŸÖÿ™ ÿßŸÑÿßÿ≥ÿ™ÿØÿπÿßÿ° ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ© ŸàŸÑŸÖ ŸäŸÉŸÜ ÿßŸÑÿπŸÜÿµÿ± ŸÖÿ±ÿ¶ŸäŸãÿß, ŸÜÿ≠ÿØÿ´ ÿßŸÑŸàÿßÿ¨Ÿáÿ©
    if (fromCart && !qtyElement) {
        const cartModal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
        if (cartModal) {
            showCart(); // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ≥ŸÑÿ© ŸÑÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÉŸÖŸäÿßÿ™
        }
    }
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ© Ÿàÿ≤ÿ± ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
    updateCartCount();
    updateOrderButton();
    
    // ÿ•ÿ∞ÿß ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸÖŸäÿ©ÿå ŸÜŸÇŸàŸÖ ÿ®ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑŸÖÿ®Ÿäÿπÿßÿ™
    if (change > 0 && currentUser) {
        const item = menuItems[itemId];
        if (item) {
            const saleRef = database.ref(`users/${currentUser.uid}/sales`).push();
            const saleData = {
                timestamp: firebase.database.ServerValue.TIMESTAMP,
                items: {
                    [itemId]: {
                        name: item.name,
                        price: item.price,
                        quantity: change
                    }
                },
                total_amount: item.price * change
            };
            saleRef.set(saleData);
        }
    }
    
    if (qtyElement) {
        qtyElement.classList.add('animate__animated', change > 0 ? 'animate__bounceIn' : 'animate__shakeX');
        setTimeout(() => {
            qtyElement.classList.remove('animate__animated', 'animate__bounceIn', 'animate__shakeX');
        }, 700);
    }
}
// ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©
function showInvoice() {
    const invoiceItems = document.getElementById('invoiceItems');
    const invoiceTotal = document.getElementById('invoiceTotal');
    const invoiceCurrency = document.getElementById('invoiceCurrency');
    
    // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ Ÿàÿ¨ŸàÿØ ÿßŸÑÿπŸÜÿßÿµÿ±
    if (!invoiceItems || !invoiceTotal || !invoiceCurrency) return;
    
    let total = 0;
    let itemsHtml = '';
    
    // ÿßÿπÿ±ÿ∂ ŸÉŸÑ ÿßŸÑÿ£ÿµŸÜÿßŸÅ ÿßŸÑÿ™Ÿä ŸÉŸÖŸäÿ™Ÿáÿß > 0 ÿ®ÿ∫ÿ∂ ÿßŸÑŸÜÿ∏ÿ± ÿπŸÜ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ≠ÿßŸÑŸä
    Object.entries(menuItems).forEach(([id, item]) => {
        if (!item) return;
        const qty = itemQuantities[id] || 0;
        if (qty > 0) {
            const itemTotal = qty * item.price;
            total += itemTotal;
            
            itemsHtml += `
                <div class="invoice-item">
                    <div>
                        <h6 class="mb-0">${item.name}</h6>
                        <small class="text-muted">${qty} √ó ${item.price.toFixed(2)} ${userSettings.currency}</small>
                    </div>
                    <div class="text-end">
                        <strong>${itemTotal.toFixed(2)} ${userSettings.currency}</strong>
                    </div>
                </div>
            `;
        }
    });
    
    invoiceItems.innerHTML = itemsHtml;
    invoiceTotal.textContent = total.toFixed(2);
    invoiceCurrency.textContent = userSettings.currency;
    
    const invoiceModal = new bootstrap.Modal(document.getElementById('invoiceModal'));
    invoiceModal.show();
}

// ÿØÿßŸÑÿ© ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
function completeOrder() {
    if (!currentUser) return;
    
    const orderData = {
        timestamp: firebase.database.ServerValue.TIMESTAMP,
        items: {},
        total_amount: 0
    };
    
    // ÿ¨ŸÖÿπ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ∑ŸÑÿ® ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿπÿßŸÖ
    Object.entries(menuItems).forEach(([id, item]) => {
        if (!item) return;
        
        const qty = itemQuantities[id] || 0;
        if (qty > 0) {
            orderData.items[id] = {
                name: item.name,
                price: item.price,
                quantity: qty
            };
            orderData.total_amount += qty * item.price;
        }
    });
    
    // ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ® ŸÅŸä Firebase
    const orderRef = database.ref(`users/${currentUser.uid}/orders`).push();
    orderRef.set(orderData).then(() => {
        // ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑŸÉŸÖŸäÿßÿ™ ŸÅŸä ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿπÿßŸÖ
        itemQuantities = {};
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿµŸÜÿßŸÅ
        displayMenuItems(menuItems);
        
        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÜÿßŸÅÿ∞ÿ© ÿßŸÑŸÅÿßÿ™Ÿàÿ±ÿ©
        const invoiceModal = bootstrap.Modal.getInstance(document.getElementById('invoiceModal'));
        if (invoiceModal) {
            invoiceModal.hide();
        }
        
        // ÿ™ÿ≠ÿØŸäÿ´ ÿ≤ÿ± ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ® ŸàÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ©
        updateOrderButton();
        updateCartCount();
        
        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ŸÜÿ¨ÿßÿ≠
        alert('ÿ™ŸÖ ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠!');
    }).catch(error => {
        console.error("Error saving order:", error);
        alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑÿ∑ŸÑÿ®. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ© ŸÖÿ±ÿ© ÿ£ÿÆÿ±Ÿâ');
    });
}

// ÿØÿßŸÑÿ© ÿ¨ŸÑÿ® ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
function fetchUserSettings(uid) {
    const settingsRef = database.ref(`users/${uid}/settings`);
    settingsRef.on('value', (snapshot) => {
        const settings = snapshot.val() || {};
        userSettings = {
            currency: settings.currency || '$',
            currencySymbol: settings.currencySymbol || '$'
        };
        // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿµŸÜÿßŸÅ ŸÖÿπ ÿßŸÑÿπŸÖŸÑÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
        displayMenuItems(menuItems);
    });
}

// ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿµŸÅÿ≠ÿ©
document.addEventListener('DOMContentLoaded', () => {
    // ÿ•ÿ∏Ÿáÿßÿ± ŸÜÿßŸÅÿ∞ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
    showLoginSection();
    
    // ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
    document.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
            e.target.classList.add('active');
            filterItems(e.target.dataset.category);
        });
    });
    updateOrderButton();
    updateCartCount();
});

// ÿØÿßŸÑÿ© ÿ•ÿ∏Ÿáÿßÿ±/ÿ•ÿÆŸÅÿßÿ° ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±
document.getElementById('togglePassword').addEventListener('click', function() {
    const passwordInput = document.getElementById('password');
    const icon = this.querySelector('i');
    
    if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        passwordInput.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
});

// ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿßÿØ ÿßŸÑÿ≥ŸÑÿ©
function updateCartCount() {
    const cartCount = document.getElementById('cartCount');
    if (!cartCount) return;
    
    let count = 0;
    
    // ÿ≠ÿ≥ÿßÿ® ÿ¨ŸÖŸäÿπ ÿßŸÑŸÉŸÖŸäÿßÿ™ ŸÅŸä itemQuantities ŸàŸÑŸäÿ≥ ŸÅŸÇÿ∑ ŸÑŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿπÿ±Ÿàÿ∂ÿ© ÿ≠ÿßŸÑŸäÿßŸã
    Object.values(itemQuantities).forEach(qty => {
        count += qty;
    });
    
    if (count > 0) {
        cartCount.textContent = count;
        cartCount.style.display = 'flex';
    } else {
        cartCount.style.display = 'none';
    }
}

// ÿØÿßŸÑÿ© ÿπÿ±ÿ∂ ÿßŸÑÿ≥ŸÑÿ©
function showCart() {
    const cartItems = document.getElementById('cartItems');
    const cartEmpty = document.getElementById('cartEmpty');
    let itemsHtml = '';
    let hasItems = false;
    
    // ÿßÿπÿ±ÿ∂ ŸÉŸÑ ÿßŸÑÿ£ÿµŸÜÿßŸÅ ÿßŸÑÿ™Ÿä ŸÉŸÖŸäÿ™Ÿáÿß > 0 ÿ®ÿ∫ÿ∂ ÿßŸÑŸÜÿ∏ÿ± ÿπŸÜ ÿßŸÑÿ™ÿµŸÜŸäŸÅ ÿßŸÑÿ≠ÿßŸÑŸä
    Object.entries(menuItems).forEach(([id, item]) => {
        const qty = itemQuantities[id] || 0;
        if (qty > 0) {
            hasItems = true;
            const itemTotal = qty * item.price;
            
            let imageHtml = '';
            if (item.image_path) {
                let imageUrl = item.image_path;
                const match = imageUrl.match(/id=([\w-]+)/);
                if (match && match[1]) {
                    imageUrl = `https://drive.google.com/thumbnail?id=${match[1]}`;
                }
                imageHtml = `<img src="${imageUrl}" class="cart-item-img" alt="${item.name}">`;
            } else {
                imageHtml = `<div class="cart-item-img d-flex align-items-center justify-content-center" style="background:#f8f9fa;color:#bbb;font-size:2rem;">üçΩÔ∏è</div>`;
            }
            
            itemsHtml += `
                <div class="cart-item" id="cart-item-${id}">
                    ${imageHtml}
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">${item.price.toFixed(2)} ${userSettings.currency}</div>
                        <div class="qty-controls">
                            <button class="qty-btn" onclick="updateQuantity('${id}', -1, true)">-</button>
                            <span class="qty-value" id="cart-qty-${id}">${qty}</span>
                            <button class="qty-btn" onclick="updateQuantity('${id}', 1, true)">+</button>
                        </div>
                    </div>
                    <div class="cart-item-total">
                        ${itemTotal.toFixed(2)} ${userSettings.currency}
                    </div>
                    <button class="cart-item-remove" onclick="removeFromCart('${id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
        }
    });
    
    cartItems.innerHTML = itemsHtml;
    cartEmpty.style.display = hasItems ? 'none' : 'block';

    // ÿ•ÿ≤ÿßŸÑÿ© ŸÉŸÑÿßÿ≥ ÿßŸÑÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿπŸÜÿßÿµÿ± ÿßŸÑÿ≥ŸÑÿ© ÿ®ÿπÿØ ÿπÿ±ÿ∂Ÿáÿß
    cartItems.querySelectorAll('.cart-item').forEach(item => {
        item.classList.remove('animate__animated', 'slideInRight');
    });

    const cartModalEl = document.getElementById('cartModal');
    const isOpen = cartModalEl.classList.contains('show');
    if (!isOpen) {
        // ÿ£ÿ∂ŸÅ ŸÉŸÑÿßÿ≥ ÿßŸÑÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ
        cartModalEl.querySelector('.modal-dialog').classList.add('animate__animated', 'animate__zoomIn');
        const cartModal = new bootstrap.Modal(cartModalEl);
        cartModal.show();

        // ÿ£ÿ≤ŸÑ ŸÉŸÑÿßÿ≥ ÿßŸÑÿ£ŸÜŸäŸÖŸäÿ¥ŸÜ ÿ®ÿπÿØ ÿßŸÜÿ™Ÿáÿßÿ°Ÿá (ŸÖÿØÿ© zoomIn ÿ™ŸÇÿ±Ÿäÿ®ÿßŸã 0.5 ÿ´ÿßŸÜŸäÿ©)
        setTimeout(() => {
            cartModalEl.querySelector('.modal-dialog').classList.remove('animate__animated', 'animate__zoomIn');
        }, 600);
    }
}

// ÿØÿßŸÑÿ© ÿ≠ÿ∞ŸÅ ŸÖŸÜ ÿßŸÑÿ≥ŸÑÿ©
function removeFromCart(itemId) {
    itemQuantities[itemId] = 0;
    const qtyElement = document.getElementById(`qty-${itemId}`);
    if (qtyElement) {
        qtyElement.textContent = '0';
    }
    updateCartCount();
    updateOrderButton();
    showCart();
}

// ÿØÿßŸÑÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿ≤ÿ± ÿ•ÿ™ŸÖÿßŸÖ ÿßŸÑÿ∑ŸÑÿ®
function updateOrderButton() {
    const orderBtn = document.getElementById('orderBtn');
    if (!orderBtn) return;
    
    let hasItems = false;
    
    // ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ ÿßŸÑŸÉŸÖŸäÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿ™ÿ∫Ÿäÿ± ÿßŸÑÿπÿßŸÖ
    Object.values(itemQuantities).forEach(qty => {
        if (qty > 0) {
            hasItems = true;
        }
    });
    
    // ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≤ÿ±
    orderBtn.disabled = !hasItems;
    if (hasItems) {
        orderBtn.style.opacity = '1';
        orderBtn.style.pointerEvents = 'auto';
    } else {
        orderBtn.style.opacity = '0.5';
        orderBtn.style.pointerEvents = 'none';
    }
}
</script>
</body>
</html>
